<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ğŸ® Mini Games PAUD - Belajar Sambil Bermain</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/games.css">
</head>
<body class="app-container">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loader"></div>
        <p>Memuat permainan...</p>
    </div>

    <!-- Home Page -->
    <div id="homePage" class="page">
        <div class="home-container">
            <!-- Header -->
            <header class="header">
                <h1 class="main-title">ğŸ® Mini Games PAUD</h1>
                <p class="subtitle">Belajar Sambil Bermain untuk Anak Cerdas & Kreatif</p>
                <button id="muteToggle" class="btn mute-btn" aria-pressed="true" title="Matikan / Nyalakan Suara">ğŸ”Š</button>
            </header>

            <!-- Player Info Section -->
            <section class="player-section">
                <input type="text" id="playerNameInput" placeholder="Masukkan nama kamu..." maxlength="20" class="input-name">
                <button onclick="app.setPlayerName()" class="btn btn-primary btn-large">Mulai Bermain!</button>
            </section>

            <!-- Age Selection -->
            <section class="age-selection">
                <h3>Pilih Usia Anak:</h3>
                <div class="age-buttons">
                    <button onclick="app.filterByAge(2)" class="age-btn">ğŸ‘¶ 2 Tahun</button>
                    <button onclick="app.filterByAge(3)" class="age-btn">ğŸ§’ 3 Tahun</button>
                    <button onclick="app.filterByAge(4)" class="age-btn">ğŸ‘¦ 4 Tahun</button>
                    <button onclick="app.filterByAge(5)" class="age-btn">ğŸ‘§ 5 Tahun</button>
                </div>
            </section>

            <!-- Games Grid -->
            <section class="games-section">
                <h2>ğŸ¯ Pilih Permainan</h2>
                <div id="gamesGrid" class="games-grid">
                    <!-- Games akan di-load di sini -->
                </div>
            </section>

            <!-- Footer -->
            <footer class="footer">
                <p>ğŸ’¡ Dikembangkan untuk mendukung perkembangan anak usia dini</p>
                <p>Â© 2024 Mini Games PAUD | Version 1.0.0</p>
            </footer>
        </div>
    </div>

    <!-- Game Page -->
    <div id="gamePage" class="page hidden">
        <div class="game-container">
            <!-- Game Header -->
            <div class="game-header">
                <button onclick="app.backToHome()" class="btn-back">â† Kembali</button>
                <h2 id="gameTitle"></h2>
                <div class="game-stats">
                    <span id="scoreDisplay">Skor: 0</span>
                    <span id="timerDisplay">Waktu: 120s</span>
                </div>
            </div>

            <!-- Game Content -->
            <div id="gameContent" class="game-content">
                <!-- Game-specific content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Results Page -->
    <div id="resultsPage" class="page hidden">
        <div class="results-container">
            <div class="results-content">
                <h2>ğŸ‰ Selesai!</h2>
                <div class="results-stats">
                    <div id="finalScore" class="stat-item">
                        <span class="label">Total Skor</span>
                        <span class="value">0</span>
                    </div>
                    <div id="accuracy" class="stat-item">
                        <span class="label">Akurasi</span>
                        <span class="value">0%</span>
                    </div>
                    <div id="badge" class="stat-item">
                        <span class="label">Badge</span>
                        <span class="value">ğŸŒŸ</span>
                    </div>
                </div>
                <div class="results-actions">
                    <button onclick="app.playAgain()" class="btn btn-primary">Bermain Lagi</button>
                    <button onclick="app.backToHome()" class="btn btn-secondary">Pilih Game Lain</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sound Effects -->
    <audio id="correctSound" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAAB9AAACABAAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj==" preload="auto"></audio>
    <audio id="wrongSound" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAAB9AAACABAAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBg==" preload="auto"></audio>
    <audio id="completeSound" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAAB9AAACABAAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBg==" preload="auto"></audio>

    <!-- Onboarding Modal (shown once) -->
    <div id="onboardingModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="onboardTitle">
        <div class="modal-inner">
            <h2 id="onboardTitle">Selamat Datang di Mini Games PAUD ğŸ‰</h2>
            <p style="margin-bottom: 20px;">Tips singkat: Pilih usia, masukkan nama, lalu pilih permainan yang ingin dimainkan. Ketuk kartu atau tombol untuk menjawab â€” mudah dan menyenangkan!</p>
            <div class="modal-actions">
                <label style="display:flex; align-items:center; justify-content:center; gap:10px; font-weight:600; cursor:pointer;">
                    <input type="checkbox" id="dontShowOnboard"> Jangan tampilkan lagi
                </label>
                <div style="display:flex; gap:12px; margin-top:20px; justify-content:center;">
                    <button id="onboardClose" class="btn btn-secondary">Tutup</button>
                    <button id="onboardStart" class="btn btn-primary">Mulai Bermain!</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import APIClient from '/assets/js/api-client.js';
        import { MiniGamesApp } from '/assets/js/app.js';
        
        // Initialize in sequence to avoid race conditions
        (async () => {
            // Create API client first
            window.api = new APIClient();
            
            // Small delay to ensure all scripts are loaded
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Now create the app
            window.app = new MiniGamesApp({ api: window.api });
            window.app.init();

            // Wire mute toggle
            const btn = document.getElementById('muteToggle');
            if (btn) {
                const stored = localStorage.getItem('soundEnabled');
                const enabled = stored === null ? true : stored === 'true';
                btn.setAttribute('aria-pressed', enabled ? 'true' : 'false');
                btn.textContent = enabled ? 'ğŸ”Š' : 'ğŸ”ˆ';

                btn.addEventListener('click', () => {
                    if (!window.app) return;
                    window.app.toggleSound();
                });
            }
        })();
    </script>
</body>
</html>
